<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.board.spring.yoony.article.ArticleDAO">

  <select id="selectArticleCount" resultType="int" parameterType="java.util.HashMap">
    SELECT COUNT(article_id) FROM article WHERE 1=1
    <if
      test="!@com.board.spring.yoony.util.ValidationChecker@isEmpty(searchWord)">
      AND (
      title like CONCAT('%',#{searchWord},'%')
      OR content like CONCAT('%',#{searchWord},'%')
      OR writer like CONCAT('%',#{searchWord},'%')
      )
    </if>
    <if
      test="!@com.board.spring.yoony.util.ValidationChecker@isEmpty(categoryId)">
      AND category_id = #{categoryId}
    </if>
    <if test="!@com.board.spring.yoony.util.ValidationChecker@isEmpty(startDate) and
    !@com.board.spring.yoony.util.ValidationChecker@isEmpty(endDate)">
      AND created_date BETWEEN date(#{startDate}) AND date(#{endDate})+1
    </if>
    ORDER BY article_id DESC
  </select>
  <select id="selectArticleList" resultType="com.board.spring.yoony.article.ArticleDTO" parameterType="java.util.HashMap">
    SELECT
      article_id, category_id,
      (
      SELECT name
      FROM category
      WHERE category_id = article.category_id LIMIT 1
      ) AS category_name,
      writer, password, title,
      content, view_count, created_date, modified_date,
      (SELECT EXISTS(SELECT 1 FROM article_file WHERE article_id = article.article_id)) AS is_file_exist
    FROM article
    WHERE 1=1
    <if
      test="!@com.board.spring.yoony.util.ValidationChecker@isEmpty(searchWord)">
      AND (
      title like CONCAT('%',#{searchWord},'%')
      OR content like CONCAT('%',#{searchWord},'%')
      OR writer like CONCAT('%',#{searchWord},'%')
      )
    </if>
    <if
      test="!@com.board.spring.yoony.util.ValidationChecker@isEmpty(categoryId)">
      AND category_id = #{categoryId}
    </if>
    <if test="!@com.board.spring.yoony.util.ValidationChecker@isEmpty(startDate) and
      !@com.board.spring.yoony.util.ValidationChecker@isEmpty(endDate)">
      AND created_date BETWEEN date(#{startDate}) AND date(#{endDate})+1
    </if>
    ORDER BY article_id DESC
    LIMIT #{pageSize} OFFSET #{rowStart}
  </select>
</mapper>